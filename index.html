<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jakob K./Evan N. Clash Royale Deck Builder</title>
<style>
  body {
    font-family: sans-serif;
    margin: 20px;
  }

  h1, h2, h3 {
    text-align: center;
  }

  #deck-slots {
    display: flex;
    gap: 10px;
    margin-bottom: 10px;
    justify-content: center;
    flex-wrap: wrap;
  }

  .slot {
    width: 80px;
    height: 120px;
    border: 2px dashed #ccc;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    position: relative;
  }

  .slot.evolution { border-color: rgb(102, 0, 102); }

  #all-cards {
    display: grid;
    grid-template-columns: repeat(auto-fill, 80px);
    gap: 10px;
    margin-top: 20px;
  }

  .card {
    width: 80px;
    height: 120px;
    cursor: pointer;
    border: 1px solid #ddd;
    position: relative;
  }

  .card img, .slot img { width: 100%; height: 100%; object-fit: contain; }

  .card.used { opacity: 0.5; cursor: not-allowed; }

  .tooltip {
    position: fixed;
    background: rgba(0,0,0,0.8);
    color: #fff;
    padding: 4px 6px;
    font-size: 12px;
    border-radius: 4px;
    white-space: nowrap;
    z-index: 10;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.05s;
  }

  #deck-rating {
    text-align: center;
    font-weight: bold;
    margin-bottom: 20px;
  }

  #megaknight-warning {
    text-align: center;
    color: darkred;
    font-weight: bold;
    margin-bottom: 10px;
    display: none;
  }
</style>
</head>
<body>

<h1>Clash Royale Deck Builder</h1>
<h2>Jakob K./Evan N.</h2>

<h3>Deck Slots</h3>
<div id="deck-slots">
  <div class="slot" data-index="0"></div>
  <div class="slot" data-index="1"></div>
  <div class="slot" data-index="2"></div>
  <div class="slot" data-index="3"></div>
  <div class="slot" data-index="4"></div>
  <div class="slot" data-index="5"></div>
  <div class="slot evolution" data-index="6"></div>
  <div class="slot evolution" data-index="7"></div>
</div>

<div id="megaknight-warning">MegaKnight? Alright, so we are making a no skill deck</div>
<div id="deck-rating">Deck Rating: 0/100</div>

<h3>All Cards</h3>
<div id="all-cards"></div>

<script>
const deck = new Array(8).fill(null);
let tooltip = null;

fetch('cards-data.json')
  .then(res => res.json())
  .then(data => initDeckBuilder(data.items))
  .catch(err => console.error('Error loading card data:', err));

function initDeckBuilder(cardsData) {
  const deckSlots = document.querySelectorAll('.slot');
  const allCardsDiv = document.getElementById('all-cards');
  const ratingDiv = document.getElementById('deck-rating');
  const megaknightWarning = document.getElementById('megaknight-warning');

  function createTooltip(card) {
    const t = document.createElement('div');
    t.className = 'tooltip';
    t.innerText = `${card.name}\nElixir: ${card.elixirCost}\nRarity: ${card.rarity}`;
    document.body.appendChild(t);
    t.style.opacity = 1;
    return t;
  }

  function moveTooltip(t, e) {
    const padding = 10;
    const rect = t.getBoundingClientRect();
    let x = e.clientX + padding;
    let y = e.clientY + padding;
    if (x + rect.width > window.innerWidth) x = e.clientX - rect.width - padding;
    if (y + rect.height > window.innerHeight) y = e.clientY - rect.height - padding;
    t.style.left = x + 'px';
    t.style.top = y + 'px';
  }

  function renderDeck() {
    deckSlots.forEach((slot, i) => {
      slot.innerHTML = '';
      if (deck[i]) {
        const img = document.createElement('img');
        img.src = slot.classList.contains('evolution') && deck[i].iconUrls.evolutionMedium
                  ? deck[i].iconUrls.evolutionMedium
                  : deck[i].iconUrls.medium;
        slot.appendChild(img);

        // Tooltip for deck slot
        slot.onmouseenter = e => { tooltip = createTooltip(deck[i]); };
        slot.onmousemove = e => { if (tooltip) moveTooltip(tooltip, e); };
        slot.onmouseleave = () => { if (tooltip) { tooltip.remove(); tooltip = null; } };
      }
    });

    // Update used cards
    allCardsDiv.querySelectorAll('.card').forEach(cardDiv => {
      const cardName = cardDiv.querySelector('img').title;
      cardDiv.classList.toggle('used', deck.some(c => c && c.name === cardName));
    });

    // Update deck rating
    updateDeckRating();
  }

  function updateDeckRating() {
    let score = 0;
    let filledCards = deck.filter(c => c !== null);

    // Base score based on number of cards
    score = Math.floor((filledCards.length / 8) * 50);

    // Bonus for average elixir in safe range
    if (filledCards.length > 0) {
      const avgElixir = filledCards.reduce((sum, c) => sum + c.elixirCost, 0) / filledCards.length;
      if (avgElixir >= 3 && avgElixir <= 5) score += 10;
    }

    // Bonus for rarities
    filledCards.forEach(c => {
      if (c.rarity === 'rare') score += 5;
      else if (c.rarity === 'epic') score += 10;
      else if (c.rarity === 'legendary') score += 15;
    });

    // Bonus for evolution slots filled
    if (deck[6] && deck[7]) score += 10;

    // Cap score 0-100
    score = Math.max(0, Math.min(100, score));
    ratingDiv.innerText = `Deck Rating: ${score}/100`;

    // Megaknight warning (becasue why use that shit card)
    const hasMegaknight = filledCards.some(c =>
      c.name.toLowerCase().includes('mega') && c.name.toLowerCase().includes('knight')
    );
    megaknightWarning.style.display = hasMegaknight ? 'block' : 'none';
  }

  // Render all cards
  cardsData.forEach(card => {
    const cardDiv = document.createElement('div');
    cardDiv.className = 'card';
    cardDiv.innerHTML = `<img src="${card.iconUrls.medium}" title="${card.name}">`;
    allCardsDiv.appendChild(cardDiv);

    // Tooltip events
    cardDiv.addEventListener('mouseenter', e => { tooltip = createTooltip(card); });
    cardDiv.addEventListener('mousemove', e => { if (tooltip) moveTooltip(tooltip, e); });
    cardDiv.addEventListener('mouseleave', () => { if (tooltip) { tooltip.remove(); tooltip = null; } });

    // Click to add to deck
    cardDiv.addEventListener('click', () => {
      if (deck.includes(card)) return; // prevent duplicates
      const emptySlotIndex = deck.findIndex(s => s === null);
      if (emptySlotIndex !== -1) {
        deck[emptySlotIndex] = card;
        renderDeck();
      }
    });
  });

  // Remove card on slot click
  deckSlots.forEach((slot, i) => {
    slot.addEventListener('click', () => {
      if (deck[i]) { deck[i] = null; renderDeck(); }
    });
  });
}
</script>

</body>
</html>

